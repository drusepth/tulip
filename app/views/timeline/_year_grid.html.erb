<!-- Year-at-a-Glance Grid View (GitHub contribution graph style) -->
<div class="cozy-card p-6 year-grid-container" data-controller="year-grid">
  <% if @years_in_range.present? %>
    <% @years_in_range.each do |year| %>
      <div class="year-grid-year mb-6 last:mb-0">
        <h4 class="year-grid-year-label"><%= year %></h4>
        <div class="year-grid-months">
          <% (1..12).each do |month| %>
            <% begin_date = Date.new(year, month, 1) %>
            <% end_date = begin_date.end_of_month %>
            <div class="year-grid-month">
              <span class="year-grid-month-label"><%= Date::ABBR_MONTHNAMES[month] %></span>
              <div class="year-grid-days">
                <% begin_date.upto(end_date) do |date| %>
                  <% stay_data = @stays_by_date[date] %>
                  <% stay = stay_data&.dig(:stay) %>
                  <% stay_index = stay_data&.dig(:index) || 0 %>
                  <% alt_class = stay_index.odd? ? '-alt' : '' %>
                  <% is_gap = @gaps_by_date[date].present? %>
                  <% is_today = date == @today %>
                  <%
                    day_class = if stay
                      case stay.status
                      when 'upcoming' then "year-grid-day-upcoming#{alt_class}"
                      when 'current' then 'year-grid-day-current'
                      when 'past' then "year-grid-day-past#{alt_class}"
                      else stay.booked? ? "year-grid-day-upcoming#{alt_class}" : "year-grid-day-planned#{alt_class}"
                      end
                    elsif is_gap
                      'year-grid-day-gap'
                    else
                      ''
                    end
                  %>
                  <div class="year-grid-day <%= day_class %> <%= 'year-grid-day-today' if is_today %>"
                       data-date="<%= date.to_s %>"
                       data-action="mouseenter->year-grid#showTooltip mouseleave->year-grid#hideTooltip"
                       <% if stay %>
                         data-stay-title="<%= stay.title %>"
                         data-stay-city="<%= stay.city %>"
                         data-stay-status="<%= stay.status %>"
                         data-stay-path="<%= stay_path(stay) %>"
                       <% elsif is_gap %>
                         data-is-gap="true"
                         data-gap-days="<%= @gaps_by_date[date][:days] %>"
                       <% end %>>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Tooltip (positioned by JS) -->
    <div class="year-grid-tooltip hidden" data-year-grid-target="tooltip">
      <div class="year-grid-tooltip-content" data-year-grid-target="tooltipContent"></div>
    </div>
  <% else %>
    <div class="text-center py-8">
      <p class="text-brown-light">No stay data available for year grid view.</p>
    </div>
  <% end %>
</div>
