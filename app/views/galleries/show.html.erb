<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8" data-controller="gallery-filter">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div>
        <div class="flex items-center gap-3 mb-2">
          <div class="w-10 h-10 rounded-full bg-gradient-to-br from-lavender-light to-lavender flex items-center justify-center">
            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
          </div>
          <div>
            <h1 class="text-2xl sm:text-3xl font-bold text-brown">Places to Visit</h1>
            <p class="text-brown-light"><%= @stay.city.present? ? @stay.city : @stay.title %><%= ", #{@stay.country}" if @stay.country.present? %></p>
          </div>
        </div>
      </div>
      <div class="flex gap-2">
        <%= button_to refresh_stay_gallery_path(@stay), method: :post, class: "btn-outline", data: { turbo_confirm: "Refresh the gallery with new venues?" } do %>
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
          Refresh
        <% end %>
        <%= link_to stay_path(@stay), class: "btn-outline" do %>
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          Back to Stay
        <% end %>
      </div>
    </div>
  </div>

  <% if @pois.any? %>
    <!-- Category Filters -->
    <% if @categories.length > 1 %>
      <div class="cozy-card p-4 mb-6 relative overflow-hidden">
        <div class="flex flex-wrap items-center gap-3">
          <p class="text-xs text-brown-light font-medium uppercase tracking-wide">Filter by</p>
          <div class="flex flex-wrap gap-2" role="navigation" aria-label="Category filters">
            <button type="button"
                    data-gallery-filter-target="pill"
                    data-category="all"
                    data-action="click->gallery-filter#filter"
                    class="category-pill active">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
              </svg>
              <span>All</span>
            </button>
            <% @categories.each do |category| %>
              <button type="button"
                      data-gallery-filter-target="pill"
                      data-category="<%= category %>"
                      data-action="click->gallery-filter#filter"
                      class="category-pill">
                <%= category_icon(category) %>
                <span><%= category.titleize %></span>
              </button>
            <% end %>
          </div>
          <span data-gallery-filter-target="count" class="ml-auto text-xs text-brown-light"><%= @pois.count %> venues</span>
        </div>
      </div>
    <% end %>

    <!-- Venue Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
      <% poi_titles = @pois.map(&:name).compact %>
      <% added_titles = @stay.bucket_list_items.where(title: poi_titles).pluck(:title).to_set %>
      <% @pois.each do |poi| %>
        <% next if poi.name.blank? %>
        <% added = added_titles.include?(poi.name) %>
        <%= render partial: "galleries/venue_card", locals: { poi: poi, added: added } %>
      <% end %>
    </div>

    <!-- Attribution notice (required by Foursquare) -->
    <div class="mt-8 p-4 rounded-2xl bg-cream border border-taupe-light">
      <div class="flex items-start gap-3">
        <svg class="w-5 h-5 text-taupe flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="currentColor">
          <path d="M17.724 3H6.104c-.866 0-1.569.713-1.569 1.59v15.398c0 .538.264 1.012.71 1.012.18 0 .37-.058.553-.175l5.83-4.142a1.12 1.12 0 01.652-.206h.053c.237 0 .465.073.652.206l5.877 4.18c.184.117.374.137.553.137.447 0 .711-.474.711-1.012V4.59C20.126 3.713 19.423 3 18.557 3h-.833z"/>
        </svg>
        <div>
          <p class="text-sm text-brown-light">
            Venue data provided by <a href="https://foursquare.com" target="_blank" rel="noopener" class="text-sage-dark hover:underline font-medium">Foursquare</a>.
            Click any venue to view on Foursquare for more details.
          </p>
        </div>
      </div>
    </div>
  <% else %>
    <!-- Empty State (no POIs with photos) -->
    <div class="cozy-card p-12 text-center">
      <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-lavender-light flex items-center justify-center">
        <svg class="w-10 h-10 text-lavender-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
      </div>
      <h2 class="text-xl font-semibold text-brown mb-2">No Venues Found</h2>
      <% if @stay.latitude.blank? || @stay.longitude.blank? %>
        <p class="text-brown-light mb-4">
          This stay doesn't have coordinates yet. Add an address to discover nearby places to visit.
        </p>
        <%= link_to edit_stay_path(@stay), class: "btn-primary inline-flex items-center" do %>
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
          </svg>
          Edit Stay
        <% end %>
      <% else %>
        <p class="text-brown-light mb-4">
          We couldn't find any venues with photos near this location. Try refreshing or check back later.
        </p>
        <%= button_to refresh_stay_gallery_path(@stay), method: :post, class: "btn-primary inline-flex items-center" do %>
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
          Try Again
        <% end %>
      <% end %>
    </div>
  <% end %>

  <!-- Back Link -->
  <div class="mt-8 pt-8 border-t border-taupe-light">
    <%= link_to stay_path(@stay), class: "text-sage-dark hover:text-sage inline-flex items-center" do %>
      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
      Back to <%= @stay.title %>
    <% end %>
  </div>
</div>
