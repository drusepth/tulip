<% commentable = local_assigns[:commentable] || local_assigns[:stay] %>
<% is_stay = commentable.is_a?(Stay) %>
<%= form_with url: commentable_comments_path(commentable),
             method: :post,
             class: "reply-form",
             data: { comment_reply_target: "formElement" } do |f| %>
  <input type="hidden" name="comment[parent_id]" value="<%= parent.id %>">
  <div class="flex gap-2">
    <%= avatar_tag(current_user, size: 24, html_options: {
      class: "w-6 h-6 ring-1 ring-lavender-light flex-shrink-0"
    }) %>
    <div class="flex-1">
      <div class="text-xs text-lavender-dark mb-1">
        Replying to <span class="font-medium"><%= parent.user.name %></span>
      </div>
      <div class="relative"
           <% if is_stay %>
           data-controller="place-mention"
           data-place-mention-search-url-value="<%= place_search_stay_path(commentable) %>"
           <% end %>>
        <%= f.text_area :body,
                        name: "comment[body]",
                        placeholder: is_stay ? "Write a reply... (type @ to mention a place)" : "Write a reply...",
                        rows: 2,
                        class: "w-full px-3 py-2 border border-taupe-light rounded-xl bg-white text-brown placeholder-brown-lighter focus:outline-none focus:border-lavender text-sm resize-none",
                        data: is_stay ? { comment_reply_target: "textarea", place_mention_target: "textarea", action: "input->place-mention#onInput keydown->place-mention#onKeydown" } : { comment_reply_target: "textarea" } %>
        <% if is_stay %>
          <div class="mention-dropdown hidden" data-place-mention-target="dropdown"></div>
        <% end %>
      </div>
      <div class="mt-2 flex justify-end gap-2">
        <button type="button"
                class="text-sm text-brown-light hover:text-brown px-3 py-1 transition-colors"
                data-action="click->comment-reply#hideForm">
          Cancel
        </button>
        <%= f.submit "Reply", class: "btn-primary px-3 py-1 text-sm bg-lavender hover:bg-lavender-dark" %>
      </div>
    </div>
  </div>
<% end %>
