<% commentable = local_assigns[:commentable] || local_assigns[:stay] %>
<% is_stay = commentable.is_a?(Stay) %>
<%= form_with url: commentable_comments_path(commentable),
             method: :post,
             id: "comment_form",
             class: "comment-form" do |f| %>
  <div class="flex gap-3">
    <%= avatar_tag(current_user, size: 32, html_options: {
      class: "w-8 h-8 ring-2 ring-lavender-light flex-shrink-0"
    }) %>
    <div class="flex-1">
      <div class="relative"
           <% if is_stay %>
           data-controller="place-mention"
           data-place-mention-search-url-value="<%= place_search_stay_path(commentable) %>"
           <% end %>>
        <%= f.text_area :body,
                        name: "comment[body]",
                        placeholder: is_stay ? "Add a comment... (type @ to mention a place)" : "Add a comment...",
                        rows: 2,
                        class: "w-full px-4 py-2.5 border-2 border-taupe-light rounded-2xl bg-white text-brown placeholder-brown-lighter focus:outline-none focus:border-lavender focus:bg-lavender-light transition-colors text-sm resize-none",
                        data: is_stay ? { place_mention_target: "textarea", action: "input->place-mention#onInput keydown->place-mention#onKeydown" } : {} %>
        <% if is_stay %>
          <div class="mention-dropdown hidden" data-place-mention-target="dropdown"></div>
        <% end %>
      </div>
      <div class="mt-2 flex justify-end">
        <%= f.submit "Comment", class: "btn-primary px-4 py-1.5 text-sm bg-lavender hover:bg-lavender-dark" %>
      </div>
    </div>
  </div>
<% end %>
