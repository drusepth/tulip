<%= turbo_frame_tag dom_id(comment) do %>
  <% is_stay = comment.commentable.is_a?(Stay) %>
  <div class="comment p-4 rounded-2xl bg-lavender-light border border-lavender">
    <%= form_with url: commentable_comment_path(comment.commentable, comment),
                  method: :patch,
                  class: "space-y-3" do |f| %>
      <div class="flex gap-3">
        <%= avatar_tag(comment.user, size: 32, html_options: {
          class: "w-8 h-8 ring-2 ring-lavender flex-shrink-0"
        }) %>
        <div class="flex-1">
          <label class="text-xs text-lavender-dark mb-1 block">Edit your comment</label>
          <div class="relative"
               <% if is_stay %>
               data-controller="place-mention"
               data-place-mention-search-url-value="<%= place_search_stay_path(comment.commentable) %>"
               <% end %>>
            <%= f.text_area :body,
                            name: "comment[body]",
                            value: comment.body,
                            rows: 3,
                            class: "w-full px-3 py-2 border border-lavender rounded-xl bg-white text-brown text-sm focus:outline-none focus:border-lavender-dark resize-none",
                            autofocus: true,
                            data: is_stay ? { place_mention_target: "textarea", action: "input->place-mention#onInput keydown->place-mention#onKeydown" } : {} %>
            <% if is_stay %>
              <div class="mention-dropdown hidden" data-place-mention-target="dropdown"></div>
            <% end %>
          </div>
        </div>
      </div>

      <div class="flex gap-2 justify-end">
        <%= link_to "Cancel",
                    commentable_path(comment.commentable),
                    class: "text-sm text-brown-light hover:text-brown px-3 py-1.5 transition-colors",
                    data: { turbo_stream: true } %>
        <%= f.submit "Save", class: "btn-primary text-sm py-1.5 px-4 bg-lavender hover:bg-lavender-dark" %>
      </div>
    <% end %>
  </div>
<% end %>
