<%# Single notification item %>
<%
  # Solid muted backgrounds for icon badge based on ring_color
  badge_bg_class = case notification.ring_color
    when "lavender" then "bg-lavender-light"
    when "sage" then "bg-sage-light"
    when "coral" then "bg-coral-light"
    when "rose" then "bg-rose-light"
    else "bg-taupe-light"
  end

  badge_text_class = case notification.ring_color
    when "lavender" then "text-lavender-dark"
    when "sage" then "text-sage-dark"
    when "coral" then "text-coral-dark"
    when "rose" then "text-rose-dark"
    else "text-taupe-dark"
  end

  # Check if we have an actor to show avatar
  actor = notification.actor

  # Unread: subtle cream background with thin sage border; Read: transparent
  unread_class = notification.unread? ? "notification-item-unread" : "notification-item-read"
%>

<div id="notification_<%= notification.id %>"
     class="notification-item relative <%= unread_class %>"
     data-notification-id="<%= notification.id %>"
     data-notification-path="<%= notification.target_path %>">
  <% if notification.target_path.present? %>
    <a href="<%= notification.target_path %>"
       class="block px-5 py-3.5 transition-colors duration-150"
       data-action="click->notifications#navigate">
  <% else %>
    <div class="block px-5 py-3.5">
  <% end %>

    <div class="flex items-start gap-3">
      <%# Avatar with icon badge, or just icon if no actor %>
      <div class="flex-shrink-0 relative">
        <% if actor %>
          <%# User avatar %>
          <%= avatar_tag(actor, size: 36, html_options: { class: "w-9 h-9 rounded-full" }) %>
          <%# Small icon badge %>
          <div class="absolute -bottom-0.5 -right-0.5 w-5 h-5 rounded-full flex items-center justify-center <%= badge_bg_class %> border-2 border-white">
            <span class="<%= badge_text_class %>" style="transform: scale(0.7);">
              <%= render "notifications/icons/#{notification.icon_name}" %>
            </span>
          </div>
        <% else %>
          <%# Just icon circle when no actor %>
          <div class="w-9 h-9 rounded-full flex items-center justify-center <%= badge_bg_class %>">
            <span class="<%= badge_text_class %>">
              <%= render "notifications/icons/#{notification.icon_name}" %>
            </span>
          </div>
        <% end %>
      </div>

      <%# Content %>
      <div class="flex-1 min-w-0">
        <p class="text-sm text-brown leading-snug">
          <%= notification.message %>
        </p>
        <p class="text-xs text-brown-lighter mt-1">
          <%= time_ago_in_words(notification.created_at) %> ago
        </p>
      </div>

      <%# Unread indicator - simple dot %>
      <% if notification.unread? %>
        <div class="flex-shrink-0 w-2 h-2 rounded-full bg-sage mt-2"></div>
      <% end %>
    </div>

  <% if notification.target_path.present? %>
    </a>
  <% else %>
    </div>
  <% end %>
</div>
